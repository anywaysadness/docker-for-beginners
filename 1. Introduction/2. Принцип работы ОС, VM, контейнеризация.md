# Основные концепции работы ОС

Например Ubuntu состоит из ***ядра*** и ***ПО***. ***Ядро*** отвечает за взаимодействие с базовым оборудованием.  
В то время как ядро остается тем же, в данном случае Linux, слой ПО, расположенный выше, отличается для разных ОС.
Это ***ПО*** может состоять из драйверов, компиляторов, интерфейса пользователя, инструментов разработчика и т.д.  
В итоге у нас есть общее ***ядро linux*** используемое во всех ОС и некоторое настраиваемое ***ПО***, которое отличает одну ОС от другой.

# Работа контейнера Docker

Контейнеры Docker совместно использует базовое ядро.

Например установленный Docker в ОС Ubuntu, может запускать поверх себя любую версию ОС если все они основаны на одном ядре.

В каждом Docker-контейнере есть только дополнительно ПО, которое делает ОС разными.

Windows не имеет такого же базового ядра как Ubuntu. Это значит что нельзя запустить контейнер на базе Windows на Docker-хосте Linux.

Для этого понадобиться Docker на сервере Windows.

Отсюда следует отличия ***контейнеризации*** от ***виртуализации***.


# Отличия контейнеризации от виртуализации

Основное назначение Docker - контейнеризация приложений, а так же их отправка и запуск.

| VM                                                                            | Docker                                         |
|-------------------------------------------------------------------------------|------------------------------------------------|
| Виртуальная машина: приложение, библиотеки, зависимости, операционная система | Контейнер: приложение, библиотека, зависимости |
| Гипервизор                                                                    | Docker                                         |
| Операционная система                                                          | Операционная система                           |
| Аппаратная инфраструктура                                                     | Аппаратная инфраструктура                      |

Как видишь справа в случае с докером у нас есть базовая аппаратная инфраструктура, затем ОС и докер, устновленный на ОС.
Докер может управлять контейнерами, которые работают с библиотеками и зависимостями сами в одиночку.

В случае виртуальной машины, у нас есть ОС на базовом оборудовании. Затем гипервизор такой как esx или какая-то другая
виртуализация. А затем виртуальная машина.

Как видишь у каждой виртуальной машины внутри своя ОС, толстый слой
зависимостей, а затем приложение. Эти накладные расходы приводят к более высокому использованию вычислительных ресурсов.
Поскольку приходится крутить несколько виртуальных ОС с их ядрами.

Также виртуальные машины потребляют больше дискового пространства поскольку каждая виртуальная машина тяжелая и обычно
имеет размер в гигабайтах. Тогда как контейнеры докер легковесны и обычно имеют размер в мегабайтах.

Это позволяет докер контейнерам загружаться быстрее, обычно за считанные секунды. Тогда как виртуальные машины грузятся
по несколько минут, так как для этого требуется загрузка всей ОС.

Также важно отметить, что докер имеет меньшую изоляцию, поскольку больше ресурсов используется совместно между
контейнерами, например ядро. Тогда как виртуальные машины полностью изолированы друг от друга.

В случае виртуальной машины у нас могут быть разные типы ОС такие как Линукс или Виндовс на основе одного и того же
гипервизора. Тогда как на докер хосте это невозможно.

Так что же выбрать: контейнеры или виртуальные машины?

Я скажу так: выбери лучшее от обеих технологий.
Ты можешь работать с контейнерами на виртуальных хостах докера. Виртуализация даст тебе возможность легковводить,
выводить из эксплуатации или перемещать большое количество докер хостов. А контейнеризация - быстро масштабироваться и
легко обновляться.

С таким подходом тебе не нужно создавать определенную виртуальную машину под конкретное приложение. Теперь это задача
виртуальной машины - запускать контейнеры и делать это хорошо. И эта эластичность и гибкость отлично подходит к облачным
вычислениям.

В облаке сегодня ты можешь иметь тысячи контейнеров на сотне докер хостов, а завтра легко вырасти или уменьшится при
необходимости.

Это были ключевые различия между ними.

# Как сделать все это руками?

На сегодняшний день доступно много контейнерных версий приложений.
Продукты большинства организаций хранятся в контейнерах и могут быть получены из общедоступного docker registry с
названием dockerhub.

Например, ты можешь найти образ наиболее распространенных ОС, БД и других сервисов и инструментов.

Как только ты определился с образом, тебе нужно установить докер на свой хост.

Для запуска приложения просто напиши команду docker run с именем образа.

```shell
docker run ansible
```

В этом случае запуск команды docker run ansible запустит экземпляр ansible на докер хосте.

Точно также запускаются экземпляры mongodb, redis, nodejs с помощью команды docker run.

Когда запускаешь экземпляр nodejs просто укажи расположение репозитория нода.

```shell
docker run mongodb
```

```shell
docker run redis
```

```shell
docker run node
```

Если тебе нужно несколько экземпляров веб-службы, просто создай требуемое количество экземпляров и настрой какой-либо
балансировщик нагрузки на входе.

В случае отказа одного из экземпляров, просто уничтож этот экземпляр и зупусти новый инстанс.

Существуют и другие решения для обработки таких случаев, их мы рассмотрим позже в ходе этого курса.

## Разница мужду образами и контейнерами.

Мы говорили об образах и контейнерах. Давай поймем разницу между ними.

Образ - это пакет или шаблон. Анологичный шаблону виртуальной машины, с которыми ты мб работал в среде виртуализации. Он
используется для создания одного или нескольких контейнеров. Докер запускает экземпляр образов, которые изолированы,
имеют свои собственные среды и процессы.

Как мы видели раньше, многи продукты уже докерезированы. Если ты не можешь найти то, что тебе нужно, ты можешь создать
образ самостоятельно. Отправить его в репозиторий в докерхаб и сделать его доступным для всех.

Если посмотреть традиционно, то приложение разрабатывают разработчики, потом передают апстриму для развертывания и
управления в производственных средах. Они делают это предоставляя набор инструкций таких как информация о том, как
должны быть устновлены хосты, какие предварительные условия должны быть соблюдены и как должны быть настроены
зависимости.

Команда ops использует это руководство для настройки приложения. Поскольку команда ops не разрабатывала приложение
самостоятельно, они борются с его настройкой. Когда они сталкиваются с проблемой, то начинают дергать разработчиков. С
докер основная часть работы, связанная с понятием инфраструктуры, теперь находится в руках разработчиков в виде
докерфайла. Руководство, ранее созданное разработчиками для настройки инфраструктуры, теперь просто ложится в докер файл
для создания образа приложения - этот образ теперь будет работать на любой контейнер на платформе и гарантированно будет
работать везде одинаково. Таким образом, команда оперирования теперь может просто использовать образ для развертывания
приложения.

Поскольку образ работал, когда разработчик создал его, а другие операции не изменяют образ, он продолжит работать таким
же образом при развертывании в производственной среде.


